import sys
import numpy as np
import scipy.stats


## uncomment below to read the values from interpolationdata2.csv and copy/paste them into arrays below.
# import csv

# # maxima = []
# # minima = []
# # skews = []
# # stdevs = []
# # means  = []
# # thresholds = []
# # print("3")
# with open('interpolationdata2.csv') as file:
#     print("3")
#     reader = csv.reader(file, delimiter=',')
#     line_count = 0
#     for row in reader:
#         if line_count == 0:
#             #print(f'Column names are {", ".join(row)}')
#             line_count += 1
#         else:
#             # maxima.append(float(row[0]))
#             # minima.append(float(row[1]))
#             # means.append(float(row[2]))
#             # stdevs.append(float(row[3]))
#             # skews.append(float(row[4]))
#             # thresholds.append(float(row[5]))
#             print(row[5], end = ',')
#             line_count += 1

## builds interpolation scheme based on values from interpolationdata2.csv
maxima = [65535,65535,65535,65535,65535,53798,65535,65535,43692,58391,65535,65535,46574,64390,65535,64491,53003,52598,65535,53935,47509,65535,65535,65535,65535,58010,65535,65535,65535,49906,52944,65535,65535,65535,65535,65535,58749,65535,65535,47332,49841,65535,65535,37809,47332,34906,65535,45170,60657,38343]
minima = [0,0,522,0,424,0,0,0,0,1809,0,762,11045,0,1771,0,0,0,0,4957,0,0,0,261,0,1333,0,1484,0,5416,6192,848,0,1771,1428,2095,848,0,0,0,0,0,1771,0,0,0,0,0,2332,0]
means = [8428.405165010428,9288.015580910318,17921.87225378788,21739.68076923077,16822.509360599077,6571.939946018893,19883.777060642733,7862.353903406535,18662.93075164717,15667.889950044078,17021.3064516129,16136.779018513076,22304.58,3107.1830676195714,13244.916774193549,17788.39393939394,18108.269128787877,16570.57819700461,20596.86076923077,12458.060357142856,2999.4084661902143,3697.922170737454,19395.630989198155,17787.50672348485,22448.14769230769,15654.048780487805,12035.334764650554,17091.426987327188,3739.3462656090474,11657.185535714285,13878.15125,16997.939372119814,19371.322128098247,13799.899892473119,15095.911107846017,15104.039817807816,16702.408698156683,16810.406970046082,10626.911053858423,18701.762986867463,16820.945708525345,13732.50935483871,13424.705483870968,2875.822901123066,18647.41132176953,2869.7327416948087,20912.806666666667,17863.163068181817,16707.387384792626,2892.765020026702]
stdevs = [3229.556857917312,3191.091605172738,5636.846653001785,10393.788520462196,6356.5362163558275,2527.423431164061,5675.1066342155345,2900.84993697725,4939.919209449275,5411.028657313079,6617.365728077064,5577.045047794169,4939.094753309702,6193.592324052531,6145.609634909003,5339.561211908788,5284.546133172677,5842.470049377353,9260.261119530964,4411.371926291333,5723.975690604715,7249.5718350828365,6444.271772797818,5323.247543397557,10545.873069435671,5374.349097202558,4223.965067072742,6256.695683644336,7280.462446487996,3984.874818884985,4931.893276146799,6633.329197675942,6431.153073254955,7653.814228872165,5285.420479174016,5121.592492377702,5977.431029126627,6584.090978855253,4152.04187606852,5019.1189686885355,5793.627484456354,6095.823544441411,6397.927777916245,5408.764656003458,5191.858747027256,5303.357132190496,8759.51017170842,5187.3188195194425,5856.9422944325825,5406.590413314903]
skews = [4.080565847493127,2.3867254782655496,2.7222130451595534,2.19541935478189,1.550043704769232,2.7137055103090684,1.3971330160549593,5.9693754920623245,0.469308920858712,2.4438049402116793,1.9053806159080104,2.690873423622147,1.5900089656103964,2.7673125306275663,2.9011970009680645,1.6981026339438723,1.232144950632488,0.6308834860139836,1.6535366457705163,4.733877067175745,2.026139507430207,2.4107414240694243,3.153056354098495,2.0596842621468765,2.110935359336326,2.6525191185926484,2.4040133375101993,1.3439065895600233,2.267510740295401,5.203987154466765,4.111900308942604,1.862504577297489,3.1772979418058442,3.6162569461897576,3.1675905146634773,3.6445825587829455,0.7014629440305279,1.8598307657420983,2.143798077683639,0.43193888323392143,0.5358865099222692,1.8836263180826665,2.9921917469199455,1.8304898170305475,0.6283536762972247,1.6779738118623369,1.4938971264747125,0.883503245910486,0.7666164236801256,1.7761868989287988]
thresholds = [25000,24000,40000,45000,45000,26000,46000,30000,32000,42000,47000,46000,36000,39000,30000,39000,36000,36000,42000,34000,29000,44000,60000,49000,63000,49000,27000,50000,48000,36000,36000,41000,53000,32000,42000,39000,35000,43000,25000,33000,32000,36000,33000,25000,36000,22000,34000,34000,35000,26000]

import scipy.interpolate

hi = scipy.interpolate.Rbf(maxima, stdevs, means, minima, skews, thresholds, function = "linear")

## takes in array of intensities as comma separated string command line argument
## outputs interpolated intensity threshold value
hist = sys.argv[1].split(",")

hist = [float(i) for i in hist]

def getThreshold(oned):	
	maxx = np.max(oned)
	minn = np.min(oned)
	stdev = np.std(oned)
	mean = np.average(oned)
	skew = scipy.stats.skew(oned)

	thresholdcalc = hi(maxx, stdev, mean, minn, skew)

	# print("max: ", maxx)
	# print("min: ", minn)
	# print("stdev: ", stdev)
	# print("mean: ", mean)
	# print("skew: ", skew)

	return thresholdcalc

print((getThreshold(hist)))


